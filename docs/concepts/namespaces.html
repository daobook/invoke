
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>构建名称空间 &#8212; Invoke  文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Testing Invoke-using codebases" href="testing.html" />
    <link rel="prev" title="Loading collections" href="loading.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="constructing-namespaces">
<span id="task-namespaces"></span><h1>构建名称空间<a class="headerlink" href="#constructing-namespaces" title="永久链接至标题">¶</a></h1>
<p>加载单个任务模块的 <a class="reference internal" href="../getting-started.html"><span class="doc">base case</span></a> 在一开始工作得很好，但高级用户通常需要更多的组织，比如将任务分割成嵌套命名空间树。</p>
<p><a class="reference internal" href="../api/collection.html#invoke.collection.Collection" title="invoke.collection.Collection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection</span></code></a> 类提供了 API 来组织任务（和 <a class="reference internal" href="configuration.html#collection-configuration"><span class="std std-ref">their configuration</span></a>）成一个树状结构。当被字符串引用时（例如在 CLI 或 pre/post 钩子中）嵌套命名空间中的任务使用点分隔语法，例如 <code class="docutils literal notranslate"><span class="pre">docs.build</span></code>。</p>
<p>在本节中，我们将展示如何使用这个 API 灵活地构建名称空间，同时还允许使用最少的样板文件遵循 Python 包布局。</p>
<section id="starting-out">
<h2>开始<a class="headerlink" href="#starting-out" title="永久链接至标题">¶</a></h2>
<p>未命名的 <code class="docutils literal notranslate"><span class="pre">Collection</span></code> 总是命名空间根；在隐式的基本情况下，Invoke 从 tasks 模块中的任务中为你创建一个。创建你自己的命名为 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> 或 <code class="docutils literal notranslate"><span class="pre">ns</span></code> 的命名空间，以建立显式的命名空间（即跳过默认的 “pull in all Task objects” 行为）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">Collection</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="c1"># or: namespace = Collection()</span>
</pre></div>
</div>
<p>使用 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection.add_task</span></code> 添加任务。<code class="xref py py-obj docutils literal notranslate"><span class="pre">add_task</span></code> 可以接受 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Task</span></code> 对象，例如由 <code class="xref py py-obj docutils literal notranslate"><span class="pre">task</span></code> 装饰器生成的</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python setup.py sdist register upload&quot;</span><span class="p">)</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">release</span><span class="p">)</span>
</pre></div>
</div>
<p>我们的可用任务列表现在看起来像这样</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release
</pre></div>
</div>
</section>
<section id="naming-your-tasks">
<h2>命名你的任务<a class="headerlink" href="#naming-your-tasks" title="永久链接至标题">¶</a></h2>
<p>“默认情况下，任务的函数名被用作它的命名空间标识符，但是你可以通过给 <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;task</span></code> <code class="docutils literal notranslate"><span class="pre">name</span></code> 参数来覆盖它（例如，在定义的时候）或者 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection.add_task</span></code> （即在 binding/attachment 时）。</p>
<p>例如，假设你在你的任务模块中有一个变量名冲突——也许你想暴露 <code class="docutils literal notranslate"><span class="pre">dir</span></code> 任务，它遮蔽了 Python 内置。将函数本身命名为 <code class="docutils literal notranslate"><span class="pre">dir</span></code> 是个坏主意，但你可以将函数命名为 <code class="docutils literal notranslate"><span class="pre">dir_</span></code>，然后告诉  <code class="docutils literal notranslate"><span class="pre">&#64;task</span></code> 这个 “real” 名字:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dir&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dir_</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>另一方面，您可能已经获得了任务对象，该对象不符合您希望在名称空间中的名称，可以在附加时重命名它。也许我们需要将 <code class="docutils literal notranslate"><span class="pre">release</span></code> 任务重命名为 <code class="docutils literal notranslate"><span class="pre">deploy</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>结果是</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    deploy
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code> kwarg 是 <code class="xref py py-obj docutils literal notranslate"><span class="pre">add_task</span></code> 的第二个参数，所以那些匆忙的人可以把它写成</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="s1">&#39;deploy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="aliases">
<h3>别名<a class="headerlink" href="#aliases" title="永久链接至标题">¶</a></h3>
<p>任务可能有额外的名称或别名，给出 <code class="docutils literal notranslate"><span class="pre">aliases</span></code> 关键字参数；它们被附加到任何隐式或显式的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 值，而不是替换</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="s1">&#39;pypi&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>结果，同一个任务有三个名称</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release
    deploy
    pypi
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>便捷的装饰器 <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;task</span></code> 是另一种设置别名的方法（例如 <code class="docutils literal notranslate"><span class="pre">&#64;task(aliases=('foo',</span> <span class="pre">'bar'))</span></code>，这对于确保给定的任务总是有一些别名设置非常有用，无论它是如何添加到命名空间的。</p>
</div>
</section>
<section id="dashes-vs-underscores">
<span id="id1"></span><h3>破折号和下划线<a class="headerlink" href="#dashes-vs-underscores" title="永久链接至标题">¶</a></h3>
<p>在函数即任务的常见情况下，你经常会发现自己编写的任务名称包含下划线:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">my_awesome_task</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Awesome!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>类似于任务参数的处理方式，将它们的下划线转换为破折号（因为这是一个常见的命令行约定），所有任务或集合名称中的下划线都将被解释为破折号，默认情况下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ inv --list
Available tasks:

  my-awesome-task

$ inv my-awesome-task
Awesome!
</pre></div>
</div>
<p>如果你希望保留下划线，你可以更新你的配置来设置  <code class="docutils literal notranslate"><span class="pre">tasks.auto_dash_names</span></code> 到 <code class="docutils literal notranslate"><span class="pre">False</span></code> 在一个非运行时 <a class="reference internal" href="configuration.html#config-files"><span class="std std-ref">config files</span></a> （系统，用户，或项目）。例如，在 <code class="docutils literal notranslate"><span class="pre">~/.invoke.yml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tasks</span><span class="p">:</span>
    <span class="n">auto_dash_names</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>为了避免混淆，这个设置在本质上是 “exclusive” -任务名称的下划线版本在 CLI 中无效 “除非 <code class="docutils literal notranslate"><span class="pre">auto_dash_names</span></code> 被禁用。（然而，在 Python 的纯函数级别上，它们必须继续用下划线引用，因为虚线名称不是有效的 Python 语法！）</p>
</div>
</section>
</section>
<section id="nesting-collections">
<h2>嵌套集合<a class="headerlink" href="#nesting-collections" title="永久链接至标题">¶</a></h2>
<p>命名空间的意义是要有子命名空间；要在Invoke中执行此操作，需要创建额外的 <a class="reference internal" href="../api/collection.html#invoke.collection.Collection" title="invoke.collection.Collection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection</span></code></a> 实例，并通过 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection.add_collection</span></code> 将它们添加到它们的父集合中。例如，假设我们有几个文档任务</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">build_docs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;sphinx-build docs docs/_build&quot;</span><span class="p">)</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">clean_docs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;rm -rf docs/_build&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>我们可以像这样将它们捆绑到一个新的命名的集合中</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docs</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="s1">&#39;docs&#39;</span><span class="p">)</span>
<span class="n">docs</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">build_docs</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">)</span>
<span class="n">docs</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">clean_docs</span><span class="p">,</span> <span class="s1">&#39;clean&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>然后用 <code class="docutils literal notranslate"><span class="pre">add_collection</span></code> 将这个新集合添加到根命名空间下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</pre></div>
</div>
<p>结果（假设 <code class="docutils literal notranslate"><span class="pre">ns</span></code> 目前只包含原始的 <code class="docutils literal notranslate"><span class="pre">release</span></code> 任务）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release
    docs.build
    docs.clean
</pre></div>
</div>
<p>与任务一样，集合可以显式地用不同的名字绑定到它们的父节点上，而不是通过 <code class="docutils literal notranslate"><span class="pre">name</span></code> kwarg（也可以像第二个常规参数 <code class="docutils literal notranslate"><span class="pre">add_task</span></code> 一样）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>结果</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release
    sphinx.build
    sphinx.clean
</pre></div>
</div>
</section>
<section id="importing-modules-as-collections">
<h2>将模块作为集合导入<a class="headerlink" href="#importing-modules-as-collections" title="永久链接至标题">¶</a></h2>
<p>在简单的单模块情况下，Invoke 本身使用的简单策略是使用类方法 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection.from_module</span></code>，作为另一个 <code class="docutils literal notranslate"><span class="pre">Collection</span></code> 构造函数，它接受 Python 模块对象作为第一个参数。</p>
<p>给定方法的模块被扫描为 <code class="docutils literal notranslate"><span class="pre">Task</span></code> 实例，这些实例被添加到新的 <code class="docutils literal notranslate"><span class="pre">Collection</span></code>。默认情况下，该集合的名称取自模块名称（<code class="docutils literal notranslate"><span class="pre">__name__</span></code> 属性），但它也可以显式提供。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>和默认的任务模块一样，你可以通过声明 <code class="docutils literal notranslate"><span class="pre">ns</span></code> 或 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> <a class="reference internal" href="../api/collection.html#invoke.collection.Collection" title="invoke.collection.Collection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection</span></code></a>  来覆盖这个默认的加载行为。在被加载模块的顶层。</p>
</div>
<p>例如，让我们将之前的单文件示例重组为一个带有几个子模块的 Python 包。首先，<code class="docutils literal notranslate"><span class="pre">tasks/release.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;python setup.py sdist register upload&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>添加 <code class="docutils literal notranslate"><span class="pre">tasks/docs.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;sphinx-build docs docs/_build&quot;</span><span class="p">)</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;rm -rf docs/_build&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>把它们联系在一起 <code class="docutils literal notranslate"><span class="pre">tasks/__init__.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">Collection</span>

<span class="kn">import</span> <span class="nn">release</span><span class="o">,</span> <span class="nn">docs</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">Collection</span><span class="o">.</span><span class="n">from_module</span><span class="p">(</span><span class="n">release</span><span class="p">))</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">Collection</span><span class="o">.</span><span class="n">from_module</span><span class="p">(</span><span class="n">docs</span><span class="p">))</span>
</pre></div>
</div>
<p>这种形式的 API 在实践中有点笨拙。幸运的是，有快捷方式 <code class="docutils literal notranslate"><span class="pre">add_collection</span></code> 会注意到当传入模块对象作为它的第一个参数时，并在内部为你调用 <code class="docutils literal notranslate"><span class="pre">Collection.from_module</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">release</span><span class="p">)</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</pre></div>
</div>
<p>无论哪种方式，结果都是</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release.release
    docs.build
    docs.clean
</pre></div>
</div>
</section>
<section id="default-tasks">
<h2>默认任务<a class="headerlink" href="#default-tasks" title="永久链接至标题">¶</a></h2>
<p>Tasks may be declared as the default task to invoke for the collection they
belong to, e.g. by giving <code class="docutils literal notranslate"><span class="pre">default=True</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;task</span></code> (or to
<code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection.add_task</span></code>.) This is useful when you have a bunch of related tasks
in a namespace but one of them is the most commonly used, and maps well to the
namespace as a whole.</p>
<p>For example, in the documentation submodule we’ve been experimenting with so
far, the <code class="docutils literal notranslate"><span class="pre">build</span></code> task makes sense as a default, so we can say things like
<code class="docutils literal notranslate"><span class="pre">invoke</span> <span class="pre">docs</span></code> as a shortcut to <code class="docutils literal notranslate"><span class="pre">invoke</span> <span class="pre">docs.build</span></code>. This is easy to do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@task</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>When imported into the root namespace (as shown above) this alters the output
of <code class="docutils literal notranslate"><span class="pre">--list</span></code>, highlighting the fact that <code class="docutils literal notranslate"><span class="pre">docs.build</span></code> can be invoked as
<code class="docutils literal notranslate"><span class="pre">docs</span></code> if desired:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release.release
    docs.build (docs)
    docs.clean
</pre></div>
</div>
<section id="default-subcollections">
<h3>Default subcollections<a class="headerlink" href="#default-subcollections" title="永久链接至标题">¶</a></h3>
<p>As of version 1.5, this functionality is also extended to subcollections: a
subcollection can be specified as the default when being added to its parent
collection, and that subcollection’s own default task (or sub-subcollection!)
will be invoked as the default for the parent.</p>
<p>An example probably makes that clearer. Here’s a tiny inline task tree with two
subcollections, each with their own default task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">task</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_all</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;build ALL THE THINGS!&quot;</span><span class="p">)</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">build_wheel</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Just the wheel&quot;</span><span class="p">)</span>

<span class="n">build</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="n">build_all</span><span class="p">,</span> <span class="n">wheel</span><span class="o">=</span><span class="n">build_wheel</span><span class="p">)</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_docs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code without docs is no code at all&quot;</span><span class="p">)</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">build_docs</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we tie those into one top level collection, setting the <code class="docutils literal notranslate"><span class="pre">build</span></code>
subcollection as the overall default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">build</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is that <code class="docutils literal notranslate"><span class="pre">build.all</span></code> becomes the absolute default task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke
build ALL THE THINGS!
</pre></div>
</div>
</section>
</section>
<section id="mix-and-match">
<h2>Mix and match<a class="headerlink" href="#mix-and-match" title="永久链接至标题">¶</a></h2>
<p>You’re not limited to the specific tactics shown above – now that you know
the basic tools of <code class="docutils literal notranslate"><span class="pre">add_task</span></code> and <code class="docutils literal notranslate"><span class="pre">add_collection</span></code>, use whatever approach
best fits your needs.</p>
<p>For example, let’s say you wanted to keep things organized into submodules, but
wanted to “promote” <code class="docutils literal notranslate"><span class="pre">release.release</span></code> back to the top level for convenience’s
sake. Just because it’s stored in a module doesn’t mean we must use
<code class="docutils literal notranslate"><span class="pre">add_collection</span></code> – we could instead import the task itself and use
<code class="docutils literal notranslate"><span class="pre">add_task</span></code> directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">Collection</span>

<span class="kn">import</span> <span class="nn">docs</span>
<span class="kn">from</span> <span class="nn">release</span> <span class="kn">import</span> <span class="n">release</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="n">ns</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">release</span><span class="p">)</span>
</pre></div>
</div>
<p>结果</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release
    docs.build
    docs.clean
</pre></div>
</div>
</section>
<section id="more-shortcuts">
<h2>More shortcuts<a class="headerlink" href="#more-shortcuts" title="永久链接至标题">¶</a></h2>
<p>Finally, you can even skip <code class="docutils literal notranslate"><span class="pre">add_collection</span></code> and <code class="docutils literal notranslate"><span class="pre">add_task</span></code> if your needs
are simple enough – <a class="reference internal" href="../api/collection.html#invoke.collection.Collection" title="invoke.collection.Collection"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Collection</span></code></a>’s constructor will take
unknown arguments and build the namespace from their values as
appropriate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">invoke</span> <span class="kn">import</span> <span class="n">Collection</span>

<span class="kn">import</span> <span class="nn">docs</span><span class="o">,</span> <span class="nn">release</span>

<span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">release</span><span class="o">.</span><span class="n">release</span><span class="p">,</span> <span class="n">docs</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice how we gave both a task object (<code class="docutils literal notranslate"><span class="pre">release.release</span></code>) and a module
containing tasks (<code class="docutils literal notranslate"><span class="pre">docs</span></code>). The result is identical to the above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    release
    docs.build
    docs.clean
</pre></div>
</div>
<p>If given as keyword arguments, the keywords act like the <code class="docutils literal notranslate"><span class="pre">name</span></code> arguments do
in the <code class="docutils literal notranslate"><span class="pre">add_*</span></code> methods. Naturally, both can be mixed together as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">deploy</span><span class="o">=</span><span class="n">release</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
</pre></div>
</div>
<p>结果</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ invoke --list
Available tasks:

    deploy
    docs.build
    docs.clean
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>You can still name these <code class="docutils literal notranslate"><span class="pre">Collection</span></code> objects with a leading string
argument if desired, which can be handy when building sub-collections.</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Invoke</a></h1>



<p class="blurb">Pythonic task execution</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pyinvoke&repo=invoke&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/pyinvoke/invoke">
    <img
        alt="https://secure.travis-ci.org/pyinvoke/invoke.svg?branch=master"
        src="https://secure.travis-ci.org/pyinvoke/invoke.svg?branch=master"
    />
</a>
</p>




    

<p>
<a class="badge" href="https://codecov.io/github/pyinvoke/invoke">
    <img
    alt="https://codecov.io/github/pyinvoke/invoke/coverage.svg?branch=master"
    src="https://codecov.io/github/pyinvoke/invoke/coverage.svg?branch=master"
    />
</a>
</p>
<h3>导航</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">快速入门</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../invoke.html"><code class="docutils literal notranslate"><span class="pre">inv[oke]</span></code> 核心用法</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="invoking-tasks.html">Invoking tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">Using Invoke as a library</a></li>
<li class="toctree-l1"><a class="reference internal" href="loading.html">Loading collections</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">构建名称空间</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#starting-out">开始</a></li>
<li class="toctree-l2"><a class="reference internal" href="#naming-your-tasks">命名你的任务</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nesting-collections">嵌套集合</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importing-modules-as-collections">将模块作为集合导入</a></li>
<li class="toctree-l2"><a class="reference internal" href="#default-tasks">默认任务</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mix-and-match">Mix and match</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-shortcuts">More shortcuts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing Invoke-using codebases</a></li>
<li class="toctree-l1"><a class="reference internal" href="watchers.html">Automatically responding to program output</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/__init__.html"><code class="docutils literal notranslate"><span class="pre">__init__</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/collection.html"><code class="docutils literal notranslate"><span class="pre">collection</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html"><code class="docutils literal notranslate"><span class="pre">config</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/context.html"><code class="docutils literal notranslate"><span class="pre">context</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/exceptions.html"><code class="docutils literal notranslate"><span class="pre">exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/executor.html"><code class="docutils literal notranslate"><span class="pre">executor</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/loader.html"><code class="docutils literal notranslate"><span class="pre">loader</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/parser.html"><code class="docutils literal notranslate"><span class="pre">parser</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/program.html"><code class="docutils literal notranslate"><span class="pre">program</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/runners.html"><code class="docutils literal notranslate"><span class="pre">runners</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tasks.html"><code class="docutils literal notranslate"><span class="pre">tasks</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/terminals.html"><code class="docutils literal notranslate"><span class="pre">terminals</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util.html"><code class="docutils literal notranslate"><span class="pre">util</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/watchers.html"><code class="docutils literal notranslate"><span class="pre">watchers</span></code></a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://daobook.github.io/invoke">主页</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>


<h3 class="donation">Donate/support</h3>







<p>
Professionally-supported Invoke is available with the
<a href="https://tidelift.com/subscription/pkg/pypi-invoke?utm_source=pypi-invoke&utm_medium=referral&utm_campaign=docs">Tidelift Subscription</a>.
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022 Jeff Forcier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/concepts/namespaces.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-18486793-3']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>