
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Loading collections &#8212; Invoke  文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="构建名称空间" href="namespaces.html" />
    <link rel="prev" title="Using Invoke as a library" href="library.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="loading-collections">
<span id="id1"></span><h1>Loading collections<a class="headerlink" href="#loading-collections" title="永久链接至标题">¶</a></h1>
<p>The core of Invoke’s execution model involves one or more Collection objects.
While these may be created programmatically, in typical use Invoke will create
them for you from Python modules it finds or is told to use.</p>
<section id="task-module-discovery">
<span id="collection-discovery"></span><h2>Task module discovery<a class="headerlink" href="#task-module-discovery" title="永久链接至标题">¶</a></h2>
<p>With no other configuration, simply calling <code class="docutils literal notranslate"><span class="pre">invoke</span></code> will look for a single
Python module or package named <code class="docutils literal notranslate"><span class="pre">tasks</span></code>, and will treat it as the root
namespace. <code class="docutils literal notranslate"><span class="pre">tasks</span></code> (or any other name given via <a class="reference internal" href="#configuring-loading"><span class="std std-ref">loading configuration
options</span></a>) is searched for in the following ways:</p>
<ul>
<li><p>First, if a valid tasks module by that name already exists on Python’s
<a class="reference external" href="http://docs.python.org/release/2.7/library/sys.html#sys.path">sys.path</a>,
no more searching is done – that module is selected.</p></li>
<li><p>Failing that, search towards the root of the local filesystem, starting with
the user’s current working directory (<a class="reference external" href="http://docs.python.org/release/2.7/library/os.html#os.getcwd">os.getcwd</a>) and try
importing again with each directory temporarily added to <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Due to how Python’s import machinery works, this approach will always
favor a package directory (<code class="docutils literal notranslate"><span class="pre">tasks/</span></code> containing an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>) over
a module file (<code class="docutils literal notranslate"><span class="pre">tasks.py</span></code>) in the same location.</p></li>
<li><p>If a candidate is found and successfully imported, its parent directory
will <strong>stay</strong> on <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> during the rest of the Python session –
this allows task code to make convenient assumptions concerning sibling
modules’ importability.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Candidate modules/packages are introspected to make sure they can actually be
used as valid task collections. Any that fail are discarded, the <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>
munging done to import them is reverted, and the search continues.</p>
</section>
<section id="configuring-the-loading-process">
<span id="configuring-loading"></span><h2>Configuring the loading process<a class="headerlink" href="#configuring-the-loading-process" title="永久链接至标题">¶</a></h2>
<p>You can configure the above behavior, requesting that Invoke alter the
collection name searched for and/or the path where filesystem-level loading
starts looking.</p>
<p>For example, you may already have a project-level <code class="docutils literal notranslate"><span class="pre">tasks.py</span></code> that you can’t
easily rename; or you may want to host a number of tasks collections stored
outside the project root and make it easy to switch between them; or any number
of reasons.</p>
<p>Both the sought collection name and the search root can be specified via
<a class="reference internal" href="configuration.html#config-files"><span class="std std-ref">configuration file options</span></a> or as <a class="reference internal" href="../invoke.html"><span class="doc">runtime CLI flags</span></a>:</p>
<ul class="simple">
<li><p><strong>Change the collection name</strong>: Set the <code class="docutils literal notranslate"><span class="pre">tasks.collection_name</span></code>
configuration option, or use <a class="reference internal" href="../invoke.html#cmdoption-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">--collection</span></code></a>. It should be a Python
module name and not a file name (so <code class="docutils literal notranslate"><span class="pre">mytasks</span></code>, not <code class="docutils literal notranslate"><span class="pre">mytasks.py</span></code> or
<code class="docutils literal notranslate"><span class="pre">mytasks/</span></code>.)</p></li>
<li><p><strong>Change the root search path</strong>: Configure <code class="docutils literal notranslate"><span class="pre">tasks.search_root</span></code> or use
<a class="reference internal" href="../invoke.html#cmdoption-r"><code class="xref std std-option docutils literal notranslate"><span class="pre">--search-root</span></code></a>. This value may be any valid directory path.</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Invoke</a></h1>



<p class="blurb">Pythonic task execution</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pyinvoke&repo=invoke&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/pyinvoke/invoke">
    <img
        alt="https://secure.travis-ci.org/pyinvoke/invoke.svg?branch=master"
        src="https://secure.travis-ci.org/pyinvoke/invoke.svg?branch=master"
    />
</a>
</p>




    

<p>
<a class="badge" href="https://codecov.io/github/pyinvoke/invoke">
    <img
    alt="https://codecov.io/github/pyinvoke/invoke/coverage.svg?branch=master"
    src="https://codecov.io/github/pyinvoke/invoke/coverage.svg?branch=master"
    />
</a>
</p>
<h3>导航</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">快速入门</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../invoke.html"><code class="docutils literal notranslate"><span class="pre">inv[oke]</span></code> 核心用法</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="invoking-tasks.html">Invoking tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">Using Invoke as a library</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Loading collections</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#task-module-discovery">Task module discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-loading-process">Configuring the loading process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="namespaces.html">构建名称空间</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing Invoke-using codebases</a></li>
<li class="toctree-l1"><a class="reference internal" href="watchers.html">Automatically responding to program output</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/__init__.html"><code class="docutils literal notranslate"><span class="pre">__init__</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/collection.html"><code class="docutils literal notranslate"><span class="pre">collection</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html"><code class="docutils literal notranslate"><span class="pre">config</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/context.html"><code class="docutils literal notranslate"><span class="pre">context</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/exceptions.html"><code class="docutils literal notranslate"><span class="pre">exceptions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/executor.html"><code class="docutils literal notranslate"><span class="pre">executor</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/loader.html"><code class="docutils literal notranslate"><span class="pre">loader</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/parser.html"><code class="docutils literal notranslate"><span class="pre">parser</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/program.html"><code class="docutils literal notranslate"><span class="pre">program</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/runners.html"><code class="docutils literal notranslate"><span class="pre">runners</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tasks.html"><code class="docutils literal notranslate"><span class="pre">tasks</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/terminals.html"><code class="docutils literal notranslate"><span class="pre">terminals</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util.html"><code class="docutils literal notranslate"><span class="pre">util</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/watchers.html"><code class="docutils literal notranslate"><span class="pre">watchers</span></code></a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://daobook.github.io/invoke">主页</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>


<h3 class="donation">Donate/support</h3>







<p>
Professionally-supported Invoke is available with the
<a href="https://tidelift.com/subscription/pkg/pypi-invoke?utm_source=pypi-invoke&utm_medium=referral&utm_campaign=docs">Tidelift Subscription</a>.
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022 Jeff Forcier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/concepts/loading.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-18486793-3']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>